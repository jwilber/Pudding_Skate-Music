<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Scrollama Demo: Fixed CSS</title>
	<meta name="description" content="Scrollama Demo: Fixed CSS">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<style>
		/* default / demo page */
		* {
			box-sizing: border-box;
		}
		
		/* scrollama */
		#scroll {
			position: relative;
			border-top: 1px dashed #000;
			border-bottom: 1px dashed #000;
			background: black;
		}
		.scroll__graphic {
			position: absolute;
			top: 0;
			left: 0;
			bottom: auto;
			background-color: black;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
		}
		.scroll__graphic.is-fixed {
			position: fixed;
		}
		.scroll__graphic.is-bottom {
			bottom: 0;
			top: auto;
		}
		.chart {
			position: absolute;
			right: 1rem;
			top: 50%;
			-moz-transform: translateY(-50%);
			-webkit-transform: translateY(-50%);
			transform: translateY(-50%);
			background: black;
		}
		.scroll__text {
			position: relative;
			/*padding: 0 1rem;*/
			max-width: 30rem;
			width: 33%;
		}
		.step {
			/*margin: 2rem auto;*/
			/*border: 1px solid #333;*/
			background-color: black;
		}
		.step.is-active {
			background-color: black;
		}

		.step.is-active p {
			font-size: 15px;
			font-weight: bold;
			height: 100%;
		}

		.step p {
			text-align: center;
			/*padding: 1rem;*/
			font-size: 12px;
			color: white;
		}

	/*	.step h4 {
			font-size: 20px;
			color: white;
			text-align: center;
		}*/

}

	</style>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js'></script>

</head>

<body>

	<section id='scroll'>
		<div class='scroll__graphic'>
			<div class='chart'>
				<!-- <p>0</p> -->
				<div class="joyplot"></div>
				<script>
					
				</script>

			</div>
		</div>

			<p>
				Throughout its existence, skateboarding has gone through its fair share of trends, with different styles coming in and out of vogue over the years.

				Particular music genres are often associated with particular styles in skateboarding; hip hop is often used with technical street skating, heavier and faster music is generally used with transition, and indie music sort of fits everywhere.


				It's not surprising, then, that year-to-year changes in the genre of skate video's often reflects the year-to-year changes in the styles of skateboarding.

				and, moreover, that the evoloving changes in music taste parallel the changes in skateboarding culture at large.

			</p>

		<div class='scroll__text'>
			<div class='step' data-step='1'>
				<p>Skate videos became a mainstay of skateboarding culture in the late 80’s. 
					For skateboarding, the 80's was a pretty wild time; vert skating, with its big airs and wild personalities, was all the rage, and skating was, for the first time, entering popular culture.

					Punk rock, a remnant of skateboarding's counter-culture origins, was extremely very popular, and many of the genre's most-popular artists, such as , , and , skated during this time period.


				Punk music dominated, which, given ..., isn't very surprising. The 80's for skateboarding was a wild time:  Mainstream skateboarding borrowed heavily from punk rock, with both influencing each other.

				This time period in skateboarding was mostly full of vert skateboarding, with many artists  
				</p>
			</div>
			<div class='step' data-step='2'>
				<h4> The 90's </h4>
				<p> In the 90’s, mainstream skateboarding transformed: vert skating died, technical street skating took over, and skateboarding entered the infamous era of ‘big pants, small wheels’[image link]. 

				The death of vert skating brought with it a heavy decline in the use of punk music. Hip Hop, a genre that would become a consistently popular, filled this gap in popularity, and boomed during the 90s. Artists such as ___, ___, and ___, were used for the first time, and set the tone of future soundtracks for years to come.

				Videos evolved as well into the standard format of each skater having his/her own part, with his/her own song to represent their skating. This format greatly increased the diveristy of the music employed, though popularity still tracks cultural trends.
<!-- 
				The use of punk music declined heavily with the death of vert skateboarding, but mirroring the change in skating culture was the evolution in music taste. Tracking the transformation from vert skating to street skating was the booming popularity of Hip Hop

				During this era, Hip Hop boomed in popularity, and filled the gap of influence left by the decline of punk music. Artists such as ___ and ___ were very popular. -->

				 </p>
			</div>
			<div class='step' data-step='3'>
				<h4> The early 2000's </h4>
				<p>In the early 2000’s,  the popularity of techincal skating is replaced with a 'bigger-is-better' approach; with more 'stairs, gaps, and rails, and baggy pants are replaced tight pants. .

				Indie music and Classic Rock replace Hip Hop as the most popular artists, and skateboarding adopts a sort of 'rock-and-roll' attitude. (For an aesthtic perspective, consider that this is the time when baggy pants were replaced with tight pants). 
			</p>
			</div>
			<div class='step' data-step='4'>
				<h4> The Contemporary</h4>
				<p> Unlike decades past, the current era of skateboarding sees no single defining aesthetic. In fact, almost all styles/approaches have an audience, and trends are even [coming back].

				Appropriately, Indie music, which itself is a broad categorization, is the most popular genre. That said, all genres see non-trivial employment in skate videos.

				The most popular artists during this year are ___, ___, and ___.  </p>
			</div>
			<div class='step' data-step='5'>
				<p> Here is some more text. Eat your heart out.</p>
			</div>
		</div>
	</section>
	<section id='outro'></section>
	<div class='debug'></div>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/scrollama/1.3.0/scrollama.js'></script>
	<script>
		var container = d3.select('#scroll');
		var graphic = container.select('.scroll__graphic');
		var chart = graphic.select('.chart');
		var text = container.select('.scroll__text');
		var step = text.selectAll('.step');
		var colors = ['coral', 'green', 'blue', 'red'];
		var width = d3.select('div.joyplot').node().offsetWidth;
		console.log(width);
		var maskRange = [0, width/4, width/2, width/ 1.5, width];

		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// Resize elements in step box
			var stepHeight = Math.floor(window.innerHeight) * .75;
			step.style('height', stepHeight + 'px');

			// 2. update width/height of graphic element
			var bodyWidth = d3.select('body').node().offsetWidth ;
			graphic.style('width', bodyWidth + 'px')
				.style('height', window.innerHeight + 'px');

			var chartMargin = 2;
			var textWidth = text.node().offsetWidth;
			var chartWidth = graphic.node().offsetWidth - textWidth - chartMargin;
			chart
				.style('width', chartWidth + 'px')
				.style('height', Math.floor(window.innerHeight ) + 'px');
			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			})
			// d3.selectAll('.line').attr('stroke', function(d, i) { return colors[response.index];});
			d3.selectAll('rect#maskRect')
				.attr('x', function(d) {
					return maskRange[response.index];
				})
				.transition()
				.duration(2500)
				.attr('x', function(d) {
					return maskRange[response.index + 1];
				});
			// var mrWidth = d3.selectAll('#maskRect').attr('width');
			// console.log(mrWidth);
			// d3.select('.maskRect').attr('width', mrWidth / 2);
		}
		function handleContainerEnter(response) {
			// response = { direction }
			// sticky the graphic (old school)
			graphic.classed('is-fixed', true);
			graphic.classed('is-bottom', false);
		}
		function handleContainerExit(response) {
			// response = { direction }
			// un-sticky the graphic, and pin to top/bottom of container
			graphic.classed('is-fixed', false);
			graphic.classed('is-bottom', response.direction === 'down');
		}

		function init() {
			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();
			// 2. setup the scroller passing options
			// this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
				container: '#scroll',
				graphic: '.scroll__graphic',
				text: '.scroll__text',
				step: '.scroll__text .step',
				offset: .1,
				debug: false,
			})
				.onStepEnter(handleStepEnter)
				.onContainerEnter(handleContainerEnter)
				.onContainerExit(handleContainerExit);
			// setup resize event
			window.addEventListener('resize', handleResize);
		}
		// kick things off
		init();
	</script>
</body>

</html>